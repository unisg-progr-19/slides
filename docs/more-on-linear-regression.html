<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 More on linear regression | 7784 Skills: Programming in R</title>
  <meta name="description" content="8 More on linear regression | 7784 Skills: Programming in R" />
  <meta name="generator" content="bookdown 0.15 and GitBook 2.6.7" />

  <meta property="og:title" content="8 More on linear regression | 7784 Skills: Programming in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 More on linear regression | 7784 Skills: Programming in R" />
  
  
  

<meta name="author" content="Kirill Müller, Christoph Sax" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualizing-statistical-output.html"/>
<link rel="next" href="transformation-3.html"/>
<script src="book_assets/jquery-2.2.3/jquery.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-left_join-to-join-data-sets"><i class="fa fa-check"></i><b>1.1</b> Using <code>left_join</code> to join data sets</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="visualization-and-reporting.html"><a href="visualization-and-reporting.html"><i class="fa fa-check"></i><b>2</b> Visualization and Reporting</a></li>
<li class="chapter" data-level="3" data-path="data-tranformation-i.html"><a href="data-tranformation-i.html"><i class="fa fa-check"></i><b>3</b> Data Tranformation I</a></li>
<li class="chapter" data-level="4" data-path="data-tranformation-ii.html"><a href="data-tranformation-ii.html"><i class="fa fa-check"></i><b>4</b> Data Tranformation II</a></li>
<li class="chapter" data-level="5" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html"><i class="fa fa-check"></i><b>5</b> Basics of R base</a><ul>
<li class="chapter" data-level="5.1" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#the-main-data-structures"><i class="fa fa-check"></i><b>5.1</b> The Main Data Structures</a><ul>
<li class="chapter" data-level="5.1.1" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#vectors-the-r-workhorse"><i class="fa fa-check"></i><b>5.1.1</b> Vectors, the R Workhorse</a></li>
<li class="chapter" data-level="5.1.2" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#matrices"><i class="fa fa-check"></i><b>5.1.2</b> Matrices</a></li>
<li class="chapter" data-level="5.1.3" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#lists"><i class="fa fa-check"></i><b>5.1.3</b> Lists</a></li>
<li class="chapter" data-level="5.1.4" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#data-frames"><i class="fa fa-check"></i><b>5.1.4</b> Data Frames</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#introduction-to-functions"><i class="fa fa-check"></i><b>5.2</b> Introduction to Functions</a><ul>
<li class="chapter" data-level="5.2.1" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#variable-scope"><i class="fa fa-check"></i><b>5.2.1</b> Variable Scope</a></li>
<li class="chapter" data-level="5.2.2" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#default-arguments"><i class="fa fa-check"></i><b>5.2.2</b> Default Arguments</a></li>
<li class="chapter" data-level="5.2.3" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#exercises-3"><i class="fa fa-check"></i><b>5.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#higher-order-functions"><i class="fa fa-check"></i><b>5.3</b> Higher-Order Functions</a><ul>
<li class="chapter" data-level="5.3.1" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#map"><i class="fa fa-check"></i><b>5.3.1</b> <code>map</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="basics-of-r-base.html"><a href="basics-of-r-base.html#loops"><i class="fa fa-check"></i><b>5.3.2</b> Loops</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="math-and-statistics.html"><a href="math-and-statistics.html"><i class="fa fa-check"></i><b>6</b> Math and Statistics</a><ul>
<li class="chapter" data-level="6.1" data-path="math-and-statistics.html"><a href="math-and-statistics.html#math"><i class="fa fa-check"></i><b>6.1</b> Math</a><ul>
<li class="chapter" data-level="6.1.1" data-path="math-and-statistics.html"><a href="math-and-statistics.html#basic-math-functions"><i class="fa fa-check"></i><b>6.1.1</b> Basic Math Functions</a></li>
<li class="chapter" data-level="6.1.2" data-path="math-and-statistics.html"><a href="math-and-statistics.html#linear-algebra-operations-on-vectors-and-matrices-optional"><i class="fa fa-check"></i><b>6.1.2</b> Linear Algebra Operations on Vectors and Matrices <em>(optional)</em></a></li>
<li class="chapter" data-level="6.1.3" data-path="math-and-statistics.html"><a href="math-and-statistics.html#statistical-distributions-optional"><i class="fa fa-check"></i><b>6.1.3</b> Statistical Distributions <em>(optional)</em></a></li>
<li class="chapter" data-level="6.1.4" data-path="math-and-statistics.html"><a href="math-and-statistics.html#set-operations-optional"><i class="fa fa-check"></i><b>6.1.4</b> Set Operations <em>(optional)</em></a></li>
<li class="chapter" data-level="6.1.5" data-path="math-and-statistics.html"><a href="math-and-statistics.html#exercises-4"><i class="fa fa-check"></i><b>6.1.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="math-and-statistics.html"><a href="math-and-statistics.html#linear-regression"><i class="fa fa-check"></i><b>6.2</b> Linear Regression</a><ul>
<li class="chapter" data-level="6.2.1" data-path="math-and-statistics.html"><a href="math-and-statistics.html#example-bootstrapping-standard-errors-optional"><i class="fa fa-check"></i><b>6.2.1</b> Example: Bootstrapping standard errors <em>(optional)</em></a></li>
<li class="chapter" data-level="6.2.2" data-path="math-and-statistics.html"><a href="math-and-statistics.html#factors-in-regression-models"><i class="fa fa-check"></i><b>6.2.2</b> Factors in regression models</a></li>
<li class="chapter" data-level="6.2.3" data-path="math-and-statistics.html"><a href="math-and-statistics.html#exercises-5"><i class="fa fa-check"></i><b>6.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="math-and-statistics.html"><a href="math-and-statistics.html#numerical-optimization-optional"><i class="fa fa-check"></i><b>6.3</b> Numerical Optimization <em>(optional)</em></a></li>
<li class="chapter" data-level="6.4" data-path="math-and-statistics.html"><a href="math-and-statistics.html#extended-exercises"><i class="fa fa-check"></i><b>6.4</b> Extended Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="visualizing-statistical-output.html"><a href="visualizing-statistical-output.html"><i class="fa fa-check"></i><b>7</b> Visualizing statistical output</a><ul>
<li class="chapter" data-level="7.1" data-path="visualizing-statistical-output.html"><a href="visualizing-statistical-output.html#the-broom-package"><i class="fa fa-check"></i><b>7.1</b> The broom package</a></li>
<li class="chapter" data-level="7.2" data-path="visualizing-statistical-output.html"><a href="visualizing-statistical-output.html#texreg-and-friends"><i class="fa fa-check"></i><b>7.2</b> texreg and friends</a></li>
<li class="chapter" data-level="7.3" data-path="visualizing-statistical-output.html"><a href="visualizing-statistical-output.html#from-data-frame-to-output-kable"><i class="fa fa-check"></i><b>7.3</b> From data frame to output: kable</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="more-on-linear-regression.html"><a href="more-on-linear-regression.html"><i class="fa fa-check"></i><b>8</b> More on linear regression</a><ul>
<li class="chapter" data-level="8.0.1" data-path="more-on-linear-regression.html"><a href="more-on-linear-regression.html#relationship-between-class-size-and-test-score"><i class="fa fa-check"></i><b>8.0.1</b> Relationship between class size and test score</a></li>
<li class="chapter" data-level="8.0.2" data-path="more-on-linear-regression.html"><a href="more-on-linear-regression.html#heteroskedasticity-consistent-standard-errors"><i class="fa fa-check"></i><b>8.0.2</b> Heteroskedasticity-consistent standard errors</a></li>
<li class="chapter" data-level="8.0.3" data-path="more-on-linear-regression.html"><a href="more-on-linear-regression.html#omitted-variable-bias"><i class="fa fa-check"></i><b>8.0.3</b> Omitted variable bias</a></li>
<li class="chapter" data-level="8.1" data-path="more-on-linear-regression.html"><a href="more-on-linear-regression.html#exercises-6"><i class="fa fa-check"></i><b>8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="transformation-3.html"><a href="transformation-3.html"><i class="fa fa-check"></i><b>9</b> Transformation 3</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">7784 Skills: Programming in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="more-on-linear-regression" class="section level1">
<h1><span class="header-section-number">8</span> More on linear regression</h1>
<p>We had a quick look at the <code>lm()</code> function and linear regressions in R. We
will deepen our knowledge by having another look at these models. This time,
we put more emphasis on the econometric side of the problem.</p>
<p>The following relies heavily on a new a new online book, <a href="https://www.econometrics-with-r.org/">Econometrics in
R</a>. This chapter covers the content of
chapters 4 to 7. Contrary to the textbook, we will rely on the tools of the
tidyverse, to unfiy the data analysis. We will not cover most of the
statistical topics in the book. The interested reader is refered to the book,
or to the underlying Econometrics textbook, <a href="https://www.pearson.com/us/higher-education/product/Stock-Introduction-to-Econometrics-3rd-Edition/9780138009007.html">Introduction to
Econometrics</a>
(which is not free).</p>
<div id="relationship-between-class-size-and-test-score" class="section level3">
<h3><span class="header-section-number">8.0.1</span> Relationship between class size and test score</h3>
<p>The book takes a careful look on the impact of class sizes on school test
scores. If, for example, a school cuts its class sizes by hiring new
teachers, that is, the school lowers the student-teacher ratios of its
classes, how would this affect the performance of the students involved in a
standardized test? With linear regression we can not only examine whether the
student-teacher ratio does have an impact on the test results but we can also
learn about the direction and the strength of this effect.</p>
<p>The dataset is included in the
<a href="https://cran.r-project.org/web/packages/AER/index.html">AER</a> package and can
be loaded as follows:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" title="1"><span class="kw">library</span>(AER)</a></code></pre></div>
<pre><code>## Loading required package: car</code></pre>
<pre><code>## Loading required package: carData</code></pre>
<pre><code>## 
## Attaching package: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:boot&#39;:
## 
##     logit</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     some</code></pre>
<pre><code>## Loading required package: lmtest</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## Loading required package: sandwich</code></pre>
<pre><code>## Loading required package: survival</code></pre>
<pre><code>## 
## Attaching package: &#39;survival&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:boot&#39;:
## 
##     aml</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb308-1" title="1"><span class="kw">data</span>(CASchools)</a></code></pre></div>
<p>The dataset contains data on test performance, school characteristics and
student demographic backgrounds for school districts in California. We will
enhance the dataset by defining two new variables, <code>student_teacher_ratio</code>,
the student-teacher ratio, and <code>test_score</code>, an average of two underlying
test scores:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb309-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb309-2" title="2">caschools &lt;-</a>
<a class="sourceLine" id="cb309-3" title="3"><span class="st">  </span>CASchools <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb309-4" title="4"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb309-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">student_teacher_ratio =</span> students <span class="op">/</span><span class="st"> </span>teachers) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb309-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">test_score =</span> (read <span class="op">+</span><span class="st"> </span>math) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb309-7" title="7"></a>
<a class="sourceLine" id="cb309-8" title="8">caschools</a></code></pre></div>
<pre><code>## # A tibble: 420 x 16
##    district school county grades students teachers calworks  lunch computer
##    &lt;chr&gt;    &lt;chr&gt;  &lt;fct&gt;  &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 75119    Sunol… Alame… KK-08       195    10.9     0.510   2.04       67
##  2 61499    Manza… Butte  KK-08       240    11.1    15.4    47.9       101
##  3 61549    Therm… Butte  KK-08      1550    82.9    55.0    76.3       169
##  4 61457    Golde… Butte  KK-08       243    14      36.5    77.0        85
##  5 61523    Paler… Butte  KK-08      1335    71.5    33.1    78.4       171
##  6 62042    Burre… Fresno KK-08       137     6.40   12.3    87.0        25
##  7 68536    Holt … San J… KK-08       195    10      12.9    94.6        28
##  8 63834    Vinel… Kern   KK-08       888    42.5    18.8   100          66
##  9 62331    Orang… Fresno KK-08       379    19      32.2    93.1        35
## 10 67306    Del P… Sacra… KK-06      2247   108      79.0    87.3         0
## # … with 410 more rows, and 7 more variables: expenditure &lt;dbl&gt;, income &lt;dbl&gt;,
## #   english &lt;dbl&gt;, read &lt;dbl&gt;, math &lt;dbl&gt;, student_teacher_ratio &lt;dbl&gt;,
## #   test_score &lt;dbl&gt;</code></pre>
<p>It is always a good idea to start with a plot. Let us refresh our knowledge
of ggplot:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb311-1" title="1">caschools <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb311-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> student_teacher_ratio, <span class="dt">y =</span> test_score)) <span class="op">+</span></a>
<a class="sourceLine" id="cb311-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb311-4" title="4"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Test scores are higher in small classes&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
<p>The plot shows the scatterplot of all observations on the student-teacher
ratio and test score. We see that the points are strongly scattered, and that
the variables are negatively correlated. That is, we expect to observe lower
test scores in bigger classes.</p>
<p>Let’s use <code>lm()</code> to estimate a linear regression model:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb312-1" title="1">m &lt;-<span class="st"> </span><span class="kw">lm</span>(test_score <span class="op">~</span><span class="st"> </span>student_teacher_ratio, <span class="dt">data =</span> caschools)</a>
<a class="sourceLine" id="cb312-2" title="2"><span class="kw">summary</span>(m)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = test_score ~ student_teacher_ratio, data = caschools)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -47.727 -14.251   0.483  12.822  48.540 
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)           698.9329     9.4675  73.825  &lt; 2e-16 ***
## student_teacher_ratio  -2.2798     0.4798  -4.751 2.78e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 18.58 on 418 degrees of freedom
## Multiple R-squared:  0.05124,    Adjusted R-squared:  0.04897 
## F-statistic: 22.58 on 1 and 418 DF,  p-value: 2.783e-06</code></pre>
<p>Thus, the coefficient on the <code>student_teacher_ratio</code> is about -2.3, i.e., a
reduced class size by one is associated with a test score increased by 2.3.</p>
<p><code>geom_smooth()</code> allows us to plot a bivariate regression line directly into a
ggplot:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb314-1" title="1">caschools <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb314-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> student_teacher_ratio, <span class="dt">y =</span> test_score)) <span class="op">+</span></a>
<a class="sourceLine" id="cb314-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb314-4" title="4"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb314-5" title="5"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Test scores are higher in small classes&quot;</span>, <span class="st">&quot;with regression line&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>
</div>
<div id="heteroskedasticity-consistent-standard-errors" class="section level3">
<h3><span class="header-section-number">8.0.2</span> Heteroskedasticity-consistent standard errors</h3>
<p>In economic contexts, some of the assumptions of the classical regression
model are usually violated, and it recommended and sometimes required to use
robust standard errors. The textbook discusses the case of
heteroskedasticity-consistent standard errors.</p>
<p>The quickest way to compute heteroskedasticity-consistent standard errors is
to use <code>robust_lm</code>, from the
<a href="https://cran.r-project.org/web/packages/estimatr/index.html">estimatr</a>
package.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb315-1" title="1"><span class="kw">library</span>(estimatr)</a>
<a class="sourceLine" id="cb315-2" title="2">m_robust &lt;-<span class="st"> </span><span class="kw">lm_robust</span>(</a>
<a class="sourceLine" id="cb315-3" title="3">  test_score <span class="op">~</span><span class="st"> </span>student_teacher_ratio,</a>
<a class="sourceLine" id="cb315-4" title="4">  <span class="dt">se_type =</span> <span class="st">&quot;HC1&quot;</span>,</a>
<a class="sourceLine" id="cb315-5" title="5">  <span class="dt">data =</span> caschools</a>
<a class="sourceLine" id="cb315-6" title="6">)</a>
<a class="sourceLine" id="cb315-7" title="7"><span class="kw">summary</span>(m_robust)</a></code></pre></div>
<pre><code>## 
## Call:
## lm_robust(formula = test_score ~ student_teacher_ratio, data = caschools, 
##     se_type = &quot;HC1&quot;)
## 
## Standard error type:  HC1 
## 
## Coefficients:
##                       Estimate Std. Error t value   Pr(&gt;|t|) CI Lower CI Upper
## (Intercept)             698.93    10.3644  67.436 9.487e-227  678.560  719.306
## student_teacher_ratio    -2.28     0.5195  -4.389  1.447e-05   -3.301   -1.259
##                        DF
## (Intercept)           418
## student_teacher_ratio 418
## 
## Multiple R-squared:  0.05124 ,   Adjusted R-squared:  0.04897 
## F-statistic: 19.26 on 1 and 418 DF,  p-value: 1.447e-05</code></pre>
<p>We can use <code>htmlreg</code> (or <code>screenreg</code>, for interactive use; or <code>texreg</code>)
from above to get a clean overview of the two estimations
(<code>include.ci = FALSE</code> is needed for a peculiarity of <code>lm_robust</code>):</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb317-1" title="1"><span class="kw">library</span>(texreg)</a></code></pre></div>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb318-1" title="1"><span class="kw">htmlreg</span>(</a>
<a class="sourceLine" id="cb318-2" title="2">  <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb318-3" title="3">    <span class="st">`</span><span class="dt">OLS s.e.</span><span class="st">`</span> =<span class="st"> </span>m,</a>
<a class="sourceLine" id="cb318-4" title="4">    <span class="st">`</span><span class="dt">heteroskedasticity-consistent s.e.</span><span class="st">`</span> =<span class="st"> </span>m_robust</a>
<a class="sourceLine" id="cb318-5" title="5">  ),</a>
<a class="sourceLine" id="cb318-6" title="6">  <span class="dt">include.ci =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb318-7" title="7">  <span class="dt">star.symbol =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">*&quot;</span>,</a>
<a class="sourceLine" id="cb318-8" title="8">  <span class="dt">doctype =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb318-9" title="9">  <span class="dt">caption =</span> <span class="st">&quot;Robust standard errors are slightly wider.&quot;</span></a>
<a class="sourceLine" id="cb318-10" title="10">)</a></code></pre></div>
<table cellspacing="0" align="center" style="border: none;">
<caption align="bottom" style="margin-top:0.3em;">
Robust standard errors are slightly wider.
</caption>
<tr>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b></b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>OLS s.e.</b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>heteroskedasticity-consistent s.e.</b>
</th>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
(Intercept)
</td>
<td style="padding-right: 12px; border: none;">
698.93<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
698.93<sup style="vertical-align: 0px;">***</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(9.47)
</td>
<td style="padding-right: 12px; border: none;">
(10.36)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
student_teacher_ratio
</td>
<td style="padding-right: 12px; border: none;">
-2.28<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
-2.28<sup style="vertical-align: 0px;">***</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.48)
</td>
<td style="padding-right: 12px; border: none;">
(0.52)
</td>
</tr>
<tr>
<td style="border-top: 1px solid black;">
R<sup style="vertical-align: 0px;">2</sup>
</td>
<td style="border-top: 1px solid black;">
0.05
</td>
<td style="border-top: 1px solid black;">
0.05
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
Adj. R<sup style="vertical-align: 0px;">2</sup>
</td>
<td style="padding-right: 12px; border: none;">
0.05
</td>
<td style="padding-right: 12px; border: none;">
0.05
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
Num. obs.
</td>
<td style="padding-right: 12px; border: none;">
420
</td>
<td style="padding-right: 12px; border: none;">
420
</td>
</tr>
<tr>
<td style="border-bottom: 2px solid black;">
RMSE
</td>
<td style="border-bottom: 2px solid black;">
18.58
</td>
<td style="border-bottom: 2px solid black;">
18.58
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;" colspan="4">
<span style="font-size:0.8em"><sup style="vertical-align: 0px;">***</sup>p &lt; 0.001, <sup style="vertical-align: 0px;">**</sup>p &lt; 0.01, <sup style="vertical-align: 0px;">*</sup>p &lt; 0.05</span>
</td>
</tr>
</table>
<p>Robust standard errors are often wider, making it less likely that an effect
is statistically significant. Whenever possible, use
heteroskedasticity-consistent standard errors.</p>
</div>
<div id="omitted-variable-bias" class="section level3">
<h3><span class="header-section-number">8.0.3</span> Omitted variable bias</h3>
<p>The previous analysis of the relationship between test score and class size
has a major flaw: we ignored other determinants of the dependent variable
(test score) that correlate with the regressor (class size). This might
induce an estimation bias. In our example we therefore wrongly estimate the
causal effect on test scores of a unit change in the student-teacher ratio,
on average. This issue is called omitted variable bias (OVB).</p>
<p>Let’s have a look at the following relationship between the percentage of
English learners (<code>english</code>) and class size:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb319-1" title="1">caschools <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb319-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> student_teacher_ratio, <span class="dt">y =</span> english)) <span class="op">+</span></a>
<a class="sourceLine" id="cb319-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb319-4" title="4"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb319-5" title="5"><span class="st">  </span><span class="kw">ggtitle</span>(</a>
<a class="sourceLine" id="cb319-6" title="6">    <span class="st">&quot;Larger classes have a larger share of English learners &quot;</span>,</a>
<a class="sourceLine" id="cb319-7" title="7">    <span class="st">&quot;with regression line&quot;</span></a>
<a class="sourceLine" id="cb319-8" title="8">  )</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-124-1.png" width="672" /></p>
<p>Since a high share of English learners is likely to have lowering impact on
test scores, this suggests that the effect of small classes is overestimated
as it captures the effect of having fewer English learners, too.</p>
<p>Multiple regression allows us to disentangle the two effects:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb320-1" title="1">m_multiple &lt;-<span class="st"> </span><span class="kw">lm_robust</span>(test_score <span class="op">~</span><span class="st"> </span>student_teacher_ratio <span class="op">+</span><span class="st"> </span>english, <span class="dt">se_type =</span> <span class="st">&quot;HC1&quot;</span>, <span class="dt">data =</span> caschools)</a>
<a class="sourceLine" id="cb320-2" title="2"><span class="kw">summary</span>(m_robust)</a></code></pre></div>
<pre><code>## 
## Call:
## lm_robust(formula = test_score ~ student_teacher_ratio, data = caschools, 
##     se_type = &quot;HC1&quot;)
## 
## Standard error type:  HC1 
## 
## Coefficients:
##                       Estimate Std. Error t value   Pr(&gt;|t|) CI Lower CI Upper
## (Intercept)             698.93    10.3644  67.436 9.487e-227  678.560  719.306
## student_teacher_ratio    -2.28     0.5195  -4.389  1.447e-05   -3.301   -1.259
##                        DF
## (Intercept)           418
## student_teacher_ratio 418
## 
## Multiple R-squared:  0.05124 ,   Adjusted R-squared:  0.04897 
## F-statistic: 19.26 on 1 and 418 DF,  p-value: 1.447e-05</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb322-1" title="1"><span class="kw">htmlreg</span>(</a>
<a class="sourceLine" id="cb322-2" title="2">  <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb322-3" title="3">    m_robust,</a>
<a class="sourceLine" id="cb322-4" title="4">    m_multiple</a>
<a class="sourceLine" id="cb322-5" title="5">  ),</a>
<a class="sourceLine" id="cb322-6" title="6">  <span class="dt">include.ci =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb322-7" title="7">  <span class="dt">star.symbol =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">*&quot;</span>,</a>
<a class="sourceLine" id="cb322-8" title="8">  <span class="dt">doctype =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb322-9" title="9">  <span class="dt">caption =</span> <span class="st">&quot;Including the share of English learners decreases the coefficient on class size.&quot;</span></a>
<a class="sourceLine" id="cb322-10" title="10">)</a></code></pre></div>
<table cellspacing="0" align="center" style="border: none;">
<caption align="bottom" style="margin-top:0.3em;">
Including the share of English learners decreases the coefficient on class size.
</caption>
<tr>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b></b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>Model 1</b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>Model 2</b>
</th>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
(Intercept)
</td>
<td style="padding-right: 12px; border: none;">
698.93<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
686.03<sup style="vertical-align: 0px;">***</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(10.36)
</td>
<td style="padding-right: 12px; border: none;">
(8.73)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
student_teacher_ratio
</td>
<td style="padding-right: 12px; border: none;">
-2.28<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
-1.10<sup style="vertical-align: 0px;">*</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.52)
</td>
<td style="padding-right: 12px; border: none;">
(0.43)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
english
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
-0.65<sup style="vertical-align: 0px;">***</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.03)
</td>
</tr>
<tr>
<td style="border-top: 1px solid black;">
R<sup style="vertical-align: 0px;">2</sup>
</td>
<td style="border-top: 1px solid black;">
0.05
</td>
<td style="border-top: 1px solid black;">
0.43
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
Adj. R<sup style="vertical-align: 0px;">2</sup>
</td>
<td style="padding-right: 12px; border: none;">
0.05
</td>
<td style="padding-right: 12px; border: none;">
0.42
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
Num. obs.
</td>
<td style="padding-right: 12px; border: none;">
420
</td>
<td style="padding-right: 12px; border: none;">
420
</td>
</tr>
<tr>
<td style="border-bottom: 2px solid black;">
RMSE
</td>
<td style="border-bottom: 2px solid black;">
18.58
</td>
<td style="border-bottom: 2px solid black;">
14.46
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;" colspan="4">
<span style="font-size:0.8em"><sup style="vertical-align: 0px;">***</sup>p &lt; 0.001, <sup style="vertical-align: 0px;">**</sup>p &lt; 0.01, <sup style="vertical-align: 0px;">*</sup>p &lt; 0.05</span>
</td>
</tr>
</table>
<p>We find that the negative coefficient on <code>student_teacher_ratio</code> is still
significant but only half the size.</p>
</div>
<div id="exercises-6" class="section level2">
<h2><span class="header-section-number">8.1</span> Exercises</h2>
<p>For this exercise, you will work with Boston, which is part of the
<a href="https://cran.r-project.org/web/packages/MASS/index.html">MASS</a> package.</p>
<ol style="list-style-type: decimal">
<li><p>Load the MASS package, check the documentation to get an overview of the
variables in <code>Boston</code>.</p></li>
<li><p>Convert <code>Boston</code> from a data frame to a tibble, called <code>boston</code>.</p></li>
<li><p>Plot a scatter-plot between the percent of households with low
socioeconomic status, <code>lstat</code>, (x-axis) and the median house value of
districts <code>medv</code>, (y-axis). Describe your observations. How appropriate is
the assumption of linearity?</p></li>
<li><p>Estimate a simple linear regression model that explains <code>medv</code> by <code>lstat</code>
and a constant. Save the model to <code>m_uni</code>. Use heteroskedasticity-consistent
standard errors.</p></li>
<li><p>Regress the median housing value in a district, <code>medv</code>, on the average age
of the buildings, <code>age</code>, the per-capita crime rate, <code>crim</code>, the percentage of
individuals with low socioeconomic status, <code>lstat</code>, and a constant. Store it
as <code>m_multi</code>.</p></li>
<li><p>Regress <code>medv</code> on all available regressors. Use the formula <code>medv ~ .</code> as
a short cut. Store the model as <code>m_full</code>.</p></li>
<li><p>Use <code>htmlreg()</code> (or <code>screereg()</code>, or <code>texreg()</code> to produce a regression
output that is ready for publication. Include <code>m_uni</code>, <code>m_multi</code> and <code>m_full</code>.
Check whether the augmented model yields a higher adjusted R2. Why is not
meaningful to compare the unadjusted R2?</p></li>
<li><p>Can we improve the model (in terms of adjusted R2), by dropping a variable?
Hint: the <code>glance</code> function makes it easy to directly access the adjusted R2.</p></li>
</ol>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualizing-statistical-output.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="transformation-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="book_assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
